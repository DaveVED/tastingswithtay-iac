######################################################################################
# Wraps and creates teh entire AWS foundation supporting tastingswithtay
#
# Using this foundation, you will get the folloiwng setup.
#
#    1. Networking configuraitons.
#    2. CICD process setup.
#    3. Compute setup to expose a ReactJS application.
#    4. Lmabda, APIGateway, and ELD connevtivity.
#
# The CI process for this foundation runs on AWS CodePipeline. We wraped it in such
# a way, so we only have to have one CodeDeploy, for the foundaiton, which then can
# deploy the ohter stacks.
######################################################################################
AWSTemplateFormatVersion: "2010-09-09"
Description: "Networking Configurations for tastingswithtay"
Parameters:
  ENV:
    Type: String
    Default: "dev"
    AllowedValues:
      - "dev"
      - "prod"
    Description: "Environment (dev, test, prod)"
  Project:
    Type: String
    Default: "myproject"
    Description: "Project name"
  Owner:
    Type: String
    Default: "DaveVED"
    Description: "GitHub repository owner"
  Repo:
    Type: String
    Default: "tastingswithtay-ui"
    Description: "GitHub repository name"
  Branch:
    Type: String
    Default: "develop"
    Description: "GitHub repository branch name"
Resources:
  Networking:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: "https://tastingswithtay-cf-iac-common-components.s3.amazonaws.com/networking.yaml"
      Parameters:
        ENV: !Ref ENV
        Project: !Ref Project
  Pipeline:
    Type: AWS::CloudFormation::Stack
    DependsOn:
      - Networking
    Properties:
      TemplateURL: "https://tastingswithtay-cf-iac-common-components.s3.amazonaws.com/pipeline.yaml"
      Parameters:
        ENV: !Ref ENV
        Project: !Ref Project
        Owner: !Ref Owner
        Repo: !Ref Repo
        Branch: !Ref Branch
  Compute:
    Type: AWS::CloudFormation::Stack
    DependsOn:
      - Networking
      - Pipeline
    Properties:
      TemplateURL: "https://tastingswithtay-cf-iac-common-components.s3.amazonaws.com/compute.yaml"
      Parameters:
        ENV: !Ref ENV
        Project: !Ref Project
